# Cron 定时任务时间选择建议

## 🎯 每日获奖者通知 - 最佳时间分析

### 功能说明

此任务通知**前一天的 Top 3 项目**创建者（日排名第 1, 2, 3 名）。

**代码逻辑：**

```typescript
// 查找昨天发布的项目中 dailyRanking 为 1, 2, 3 的项目
const yesterday = subDays(startOfDay(now), 1)
const winners = await db
  .select()
  .from(project)
  .where(
    and(
      eq(project.launchStatus, launchStatus.LAUNCHED),
      inArray(project.dailyRanking, [1, 2, 3]),
      gte(project.scheduledLaunchDate, yesterday),
      lt(project.scheduledLaunchDate, startOfDay(now)),
    ),
  )
```

### ⏰ 推荐时间：UTC 01:00（每天）

```
Schedule: Every day
Time: 01:00 UTC
```

### 🤔 为什么选择 UTC 01:00？

#### ✅ 优势

1. **排名稳定期**

   - 前一天的项目已经过了 24 小时
   - 点赞和评论活动基本结束
   - `dailyRanking` 已经固定
   - 避免在排名还在变化时发送邮件

2. **用户体验好**

   - **美国东部时间：** 20:00 (前一天晚上) - 晚餐后查看邮件
   - **欧洲时间：** 02:00-03:00 (凌晨) - 早上起床看到
   - **亚洲时间：** 09:00-10:00 (上午) - 上班时看到
   - 大部分用户会在醒来后第一时间看到好消息！🎉

3. **避开系统高峰**

   - ProductHunt 导入在 UTC 17:00
   - 虚拟互动在偶数小时（00:00, 02:00...）
   - UTC 01:00 是相对空闲的时间段

4. **激励效果最佳**
   - 获奖邮件是正面反馈
   - 早上看到会让用户一整天都有好心情
   - 可能促使用户分享或宣传项目

### 🔄 备选时间方案

#### 方案 A: UTC 00:30（更早通知）

```
Schedule: Every day
Time: 00:30 UTC
```

**适用场景：**

- 希望尽快通知获奖者
- 确信 00:00 时排名已经稳定

**优点：**

- 用户更早收到通知
- 西海岸用户晚上就能看到（17:30 PST）

**缺点：**

- 如果有跨天的点赞活动，排名可能还在变化
- 可能有极少数"误报"

#### 方案 B: UTC 02:00（更保守）

```
Schedule: Every day
Time: 02:00 UTC
```

**适用场景：**

- 希望绝对确保排名稳定
- 愿意牺牲一点通知速度

**优点：**

- 排名绝对稳定
- 几乎不可能有误报

**缺点：**

- 通知稍晚
- 欧洲用户会更晚看到（03:00-04:00）

#### 方案 C: UTC 08:00（工作时间通知）

```
Schedule: Every day
Time: 08:00 UTC
```

**适用场景：**

- 希望用户在工作时间看到
- 希望有更多的互动和社交分享

**优点：**

- 欧洲用户上班时收到（09:00-10:00）
- 可能促进更多的社交媒体分享

**缺点：**

- 美国用户会在凌晨收到（00:00-03:00 PST/EST）
- 不如早上通知有惊喜感

### 🌍 全球时区对比

以下是不同 UTC 时间对应的各时区本地时间：

| UTC 时间  | 美国东部 (EST)   | 美国西部 (PST)   | 欧洲 (CET) | 中国 (CST) | 印度 (IST) |
| --------- | ---------------- | ---------------- | ---------- | ---------- | ---------- |
| 00:30     | 19:30 (前夜)     | 16:30 (前夜)     | 01:30      | 08:30      | 06:00      |
| **01:00** | **20:00 (前夜)** | **17:00 (前夜)** | **02:00**  | **09:00**  | **06:30**  |
| 02:00     | 21:00 (前夜)     | 18:00 (前夜)     | 03:00      | 10:00      | 07:30      |
| 08:00     | 03:00            | 00:00            | 09:00      | 16:00      | 13:30      |

**最佳覆盖：UTC 01:00**

- ✅ 美国用户晚上查邮件
- ✅ 欧洲用户早上起床看到
- ✅ 亚洲用户上班时收到

### 📊 与其他任务的协调

确保各个定时任务不冲突：

```
17:00 UTC - ProductHunt 导入（约 5-10 分钟）
00:00 UTC - 虚拟互动（约 2-3 分钟）
01:00 UTC - 📧 每日获奖者通知（约 1-2 分钟）⭐ 推荐
02:00 UTC - 虚拟互动（约 2-3 分钟）
04:00 UTC - 虚拟互动（约 2-3 分钟）
...
09:00 UTC - 发送提醒邮件（约 2-3 分钟）
每小时整点 - 更新项目状态（约 1 分钟）
```

**时间分布均匀，互不干扰** ✅

### 🎯 实施建议

#### 第一阶段：观察期（推荐 UTC 01:00）

```
频率: 每天
时间: 01:00 UTC
持续: 1-2 周
```

观察：

- 邮件打开率
- 用户反馈
- 排名是否偶尔有变化

#### 第二阶段：根据数据优化

如果发现：

- **邮件打开率低** → 考虑调整到 UTC 08:00（工作时间）
- **偶尔有排名变化** → 推迟到 UTC 02:00
- **一切正常** → 保持 UTC 01:00 ✅

### 📧 邮件发送时间的心理学

根据邮件营销研究：

1. **早上 8-10 点**（本地时间）- 最高打开率

   - 人们刚开始工作，会查看邮件
   - UTC 01:00 对亚洲用户正好是这个时间段

2. **晚上 6-9 点**（本地时间）- 第二高打开率

   - 晚餐后放松时间
   - UTC 01:00 对美国用户正好是这个时间段

3. **凌晨 2-4 点**（本地时间）- 最低打开率
   - 但用户早上起来会看到未读邮件
   - UTC 01:00 对欧洲用户是这个时间，但他们早上会看到

**结论：UTC 01:00 在心理学上也是最优选择** 🎯

### 🔔 通知内容建议

无论选择什么时间，邮件内容都应该：

1. **主题行要激动人心**

   ```
   🏆 Congratulations! Your project ranked #1 on Open-Launch!
   ```

2. **内容要包含**

   - 🏅 明确的排名（#1, #2, #3）
   - 📊 获得的点赞数/评论数
   - 🎖️ 获奖徽章（可以展示在项目页面）
   - 🔗 项目链接
   - 💡 分享到社交媒体的建议

3. **行动号召（CTA）**
   - 分享到 Twitter/LinkedIn
   - 添加获奖徽章到网站
   - 感谢支持者

### ✅ 最终推荐

**标准配置：**

```
Task Name: Send Daily Winner Notifications
URL: https://www.aat.ee/api/cron/send-winner-notifications
Schedule: Every day
Time: 01:00 UTC
Header: Authorization: Bearer YOUR_SECRET
Timeout: 60 seconds
```

**理由：**

- ✅ 排名稳定
- ✅ 全球用户覆盖最佳
- ✅ 打开率预期最高
- ✅ 避开系统高峰
- ✅ 心理学最优

## 📚 相关文档

- [CRON_JOB_ORG_SETUP.md](./CRON_JOB_ORG_SETUP.md) - 完整配置指南
- [CRON_QUICK_REFERENCE.md](./CRON_QUICK_REFERENCE.md) - 快速参考
- [CRON_AUTH_METHODS.md](./CRON_AUTH_METHODS.md) - 认证方式

---

**需要调整？** 运行 1-2 周后根据邮件打开率和用户反馈进行优化。
